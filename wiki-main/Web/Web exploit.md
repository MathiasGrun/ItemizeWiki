# Web exploit

## Nettside og URL
(https://developer.mozilla.org/en-US/docs/Learn/Common_questions/What_is_a_URL). En _webpage_ er en samling av flere _websites_. (Vanskelig å finne norsk oversettelse). 
En nettside er hva vi kan nå ved å skrive inn en _URL_  (Uniform Resource Locator) i en nettleser(/browser) (Chrome, Safari, Firefox, osv.). En _URL_ kan se slik ut: 
"https://www.eksempelnavn.no:443/path/til/minfil.html?key1=value1&key2=value2#etstedidokumentet
 En _URL_ er bygget opp av: 
- "Scheme": eks "https"
- Domenenavn: eks "www.eksempelnavn.no"
- Port: eks "443"
- (Domenenavn og port sammen kalles "Authority" (autoritet)). 
- Path til fil: "path/til/minfil.html"
- Parameter: "?key1=value1&key2=value2"
- Anchor (anker): "#etstedidokumentet"

Et tips er å se på en URL som noen sin adresse når du skal sende et brev: _scheme_ er hvilken posttjeneste du vil bruke, domenenavn er by, _port_ er postkode, _path_ er bygningen brevet skal til, _parametre_ er ekstrainformasjon som leilighetsnummer og _anchor_ er navnet på personen brevet skal til. 

_Scheme_ sier altså hvilken protoll vi bruker. I eksempel er det "HTTPS" (Hypertext Transfer Protocol w/ SSL). 
_Authority_ sier hvem sin server du skal bruke. Dette er egentlig en IP-adresse, men en DNS-server oversetter dette for oss. _Port_ sier noe om hvilke ressurser web-serveren skal bruke. Det er ofte ikke nødvendig å ha med, fordi det er gitt under _scheme_. HTTP bruker f.eks. port 80 og HTTPS bruker port 443. _Path_ forteller stien til dokumentet vi ønsker å hente. _Parametre_ er en ekstra liste med verdier, separert med "&" som web-serveren kan gjøre forskjellige ting med. Det er også denne delen av _URL'en_ som kalles en "Query". _Anchor_ er et spesifikt sted på en website. Altså scrollet ned en plass osv. 

En nettside er skrevet i _HTML_ (Hypertext Markup Language). Det er et programmeringsspråk, så det krever litt forståelse av hvordan syntaxen ser ut. For å få _HTML_-outputtet til å se annerledes ut, brukes CSS. Så det vi altså ser på en nettside er HTML og CSS. For at vi skal kunne interagere med det vi ser, brukes JS (JavaScript). 

Vi sier at når du, som bruker, interagerer med en nettside, er du "client" (klient). Nettsiden (egentlig serveren der nettsiden "ligger") kalles en "host" (vert).

## Utviklerverktøy
På alle nettsider vi besøker, kan vi se all koden til nettsiden. Dette gjøres ved å høyreklikke og trykke på "Vis kildekode". Da ser vi HTML-koden. Det er og mulig å åpne en bok som kalles "Utviklerverktøy". Forskjellige nettlesere bruker forskjellige utviklerverktøy. Herfra vil jeg bruke Google sin utviklerverktøy. Dette verktøyet er veldig mektig, både for CTF, og for andre utvikler-baserte operasjoner. 
For å åpne utviklerverktøy, kan man trykke ctrl(cmd på Mac)+shift+i, man kan trykke f12, eller man kan høyreklikke et sted på siden og trykke "Inspiser". 

Det har nå kommet opp en hvit (svart hvis du bruker night mode) boks. Øverst i boksen ser vi en rad med forskjellige underkategorier: "Elements", "Console", osv. Vi skal først se på "Elements".

Her er et cheatsheet fra Google: http://anti-code.com/devtools-cheatsheet/

### Elements
Det vi da ser, er HTML-koden. Den andre boksen, der det står "Styles", "Computed", osv er CSS-koden. Vi kan se hvordan vi kan bevege musepekeren over forskjellige kodelinjer og se på nettsiden hva kodelinjene handler om. Vi kan og gjøre dette motsatt, ved å trykke på den lille boksen med en musepeker på, helt øvsert til venstre. Da vil vi kunne se på forskjellige ting i nettleseren, så markeres de kodelinjene det representerer. Vi kan fritt velge å endre på kodelinje i HTML-koden. Dette endrer det naturligvis bare for deg, og slettes når siden oppdateres. 

![Endring av HTML-kode](bilder/endre_html-kode.PNG)

Man kan og endre andre ting enn tekst, men på et litt mer avansert nivå, vil dette kreve mer kunnskap innenfor CSS og HTML. Men her er det bare å leke seg og prøve seg litt fram slik at man blir bedre på webuvikling.

![Endring av HTML-kode](bilder/mr_meeseeks_i_komtek.PNG)

### Console
Her er det en liten boks, der du kan skrive kommandoer i JS. Som kjent fra _"Terminalen"_, kan en konsoll gi oss mye makt. Her er det naturligvis mange restriksjoner på hva som er lov. Videre har, i de aller fleste tilfeller, utviklerne av en nettside forhindret oss i å gjøre noe som kan skade nettsiden her. Men det finnes mye vi kan gjøre og: 

```console
alert("dette er en alarm")
```

vil sende ut en liten boks med den gitte teksten. 

(Går ikke særlig gjennom Audit, Sources og Network)

### Application
Her ser vi alt som er lagret i nettleseren. Dette innebærer ting som brukernavn, _websites_ du har besøkt på _webpagen_ osv. F.eks. _Cookies_ er noe vi hører mye om i dag, men som er helt essensielt for at vi skal kunne operere som vi gjør på nettet. 
Først har vi _Local Storage_ og _Session Storage_. Forskjellen på disse er at det som lagres i _Local Storage_ vil lagres helt til du manuelt sletter det. Det som blir lagret i _Session Storage_ lagres kun i en "session". En "session" kan ha varierende lengde. Det kan f.eks. bli avbrutt av at du har vært inaktiv på siden i 30 minutter. 
Vi kan og se våre _Cookies_. Disse kan vi endre på som vi vil. I noen CTF-oppgaver kan dette være svært hjelpsomt. 

### PicoCTF Web Exploit oppg. 1
Oppgaven heter Inspect0r og hintet spør om vi vet hvordan vi kan se kildekode. Vi går inn på linken og finner en enkel hjemmeside. Det står at det er brukt HTML, CSS og JS for å lage nettsiden. Ved å se kildekoden, ser vi første delen av flagg 1/3 i en kommentar i HTML-koden (picoCTF{tru3_d3)). Vi kan og åpne utviklerverktøy for å se JS og CSS. Her har forskjellige nettlesere litt forskjellige utviklerverktøy. Jeg bruker Chrome i dette eksempelet. Hvis vi trykket på "Sources", helt øverst, så "Page" litt under, til venstre, ser vi tre forskjellige filer. Det første er (index) som er HTML-filen. Vi kan altså finne flagg 1/3 her også. I JS-filen, ser vi flagg 3/3 (_lucky?d3db9182}) og i CSS filen finner vi flagg 2/3 (t3ct1ve_0r_ju5t). Sammen blir dette: _picoCTF{tru3_d3t3ct1ve_0r_ju5t_lucky?d3db9182}_.

### PicoCTF Web Exploit oppg. 2
Her kommer vi inn på en nettside som ber om et passord. Hvis vi prøver å skrive inn noe så dukker det opp en boks som sier at det er feil passord. Vi må altså finne ut hva som er riktig passord. Oppgavenavnet sier at vi ikke skal bruke klient-side og hintet sier at vi "aldri skal stole på en klient". I dette tilfellet er det vi som bruker nettsiden som er klienter. Vi interagerer med JS-scriptet. Ved å inspisere, ser vi og at det ikke er noe JS-script for oss å se. Vi ser derimot på "(index)", at det er noe kode som er interessant. Vi ser at det er en funksjon som tar inn det vi skriver som passord. Vi kan og se deler av et flagg. Funksjonen sjekker altså om vi skriver inn flagget som passord. Uten alt for mye kodeforståelse, ser vi at den har splittet opp flagget i flere seksjoner. Vi kan faktisk lese her hva som er flagget. (0, split) er den første delen av flagget, (split, split\*2) er den andre delen, (split\*2, split\*3) er den tredje delen osv. Flagget blir da: picoCTF{no_clients_plz_577431}

### PicoCTF Web Exploit oppg. 3
<!-- sefskejnf -->
Her kommer vi til en innloggingsside. Vi kan prøve å logge inn med hva som helst, og det går. Ved å se på kildekoden, er det ingenting vi kan se direkte. Oppgaven forteller oss at vi skal logge på som "logon", noe som heller ikke hjelper oss alt for mye. Hintet forteller oss at det ikke ser ut til at scriptet sjekker noens navn, utenom "{{name}}'s", hvilket er det vi ser i kildekoden. Dermed kan det være en idé å bruke noen av de andre triksene i utviklerverktøyet.  Vi har logget inn (med hva som helst), ser ikke  flagget. Under "Application" -> "Cookies" finner vi noe spennende. Når vi skriver inn noe i en nettleser, er det vanlig at det lagres som "Cookies" (informasjonskapsler). Litt avhengig av hvordan nettsiden er satt opp, lagres Cookies forskjellige. Cookies er din informasjon og du har fullstendid rett til å endre på de, akkurat som du vil. På denne våre cookies, ser vi at vi har en cookie som heter "Admin". Det er som oftest navnet på administrasjonskontoen til nettsiden, altså de som har tilgang til det meste. Vi ser og at verdien ("Value") til Admin-feltet er satt til "False" i vår Cookie. Denne kan vi endre. Hvis vi setter den til "True" og oppdaterer siden, ser vi flagget: _picoCTF{th3_c0nsp1r4cy_l1v3s_9e21365b}_.
Her kan du finne mer informasjon om Cookies: https://en.wikipedia.org/wiki/HTTP_cookie .

### PicoCTF Web Exploit oppg 3. 
"Can you find the robots?" er oppgavenavnet. Her trenger vi informasjon om en viktig ting. Som nevnt, kjører en webpage på en server. En webpage er delt inn i mange websites. Det har seg og slik at det finnes mange tjenester (som f.eks. Google) som har kapasitet til å lete etter informasjon overalt på internettet. For å forhindre at f.eks. Google konstant skal se gjennom absolutt alle websitesene dine, eller pathene til de forskjellige filene, bruker vi det som kalles en "_robots.txt_"-fil. Dette er en egen fil man kan ha på nettsiden. Denne filen er kun en tekstfil men forteller da Google sine "web crawlers" hvilke filer på din server de har lov til å søke seg gjennom. På de aller fleste nettsider finnes det en robots.txt-fil. Man kan se på ntnu.no/robots.txt for å se hvilke filer de ikke ønsker at Web Crawlers skal søke gjennom. 
Tilbake til oppgaven: Dersom vi skriver inn robots.txt på slutten av URL'en til oppgaven ser vi hva som er "Disallowed". Vi ser at det er en html-fil. Vi kan erstatte robots.txt med denne for å komme inn på html-filen. Der finner vi flagget: _picoCTF{ca1cu1at1ng_Mach1n3s_e0779}_.

### PicoCTF Web Exploit oppg 4. 
Denne er rimelig lik som opp. 2 men funksjonen vi skal finne, er mye mer avansert. Det brukes et triks som er vanlig å bruke i Web Exploit og Reverse Engineering, som skall "Obfuscation". Det handler rett og slett om å gjøre noe vanskelig å lese/forvirrende. Heldigvis har vi verktøy som skal hjelpe oss med dette. Når vi bruker Chrome sitt utviklerverktøy, får vi opp en boks som spør om vi ønsker "Pretty-print of this minified text?". Det ønsker vi gjerne. Her har noen altså skrevet et script, for så å gjøre det vanskelig for oss å lese. Google har innebygde funksjoner som hjelper med det. Hvis ikke man ønsker å gjøre det slik, kan man søke på "de-obfuscator", kopiere teksten og håpe man får litt hjelp der. For å finne flagget, gjør vi nå det samme som sist gang. Vi kan enten sjekke hva hele verify()-funksjonen gjør og hvordan den fungerer, eller så kan vi være litt sleipe: vi vet at flagget er på formen picoCTF{etellerannet_tall}. Vi ser mye av dette i store deler av teksten. Flagget blir da: picoCTF{not_this_again_39d025}

### PicoCTF Web Exploitation oppg 5. 
Flagget kan kun sees av admin og klokka må være 1400. Hintet er om Cookies kan hjelpe med å fikse dette. Et triks med cookies er at man kan lage sine egne. Inne på cookies på denne siden, er det ingenting spennende. Men vi lager våre egne. Bare dobbeltrykk på under "Name" så skriver man en cookie som heter "admin". Gi den en verdi, "True". Så gjør vi det samme med "time" og verdi som er "1400". Deretter kan vi oppdatere siden og få flagget: picoCTF{0p3n_t0_adm1n5_2e8d3883}




## Database og SQL 
En database er en samling med informasjon. En nettside trenger en database til å lagre informasjon. Dette kan være f.eks. en samling av alle registrerte brukere, diverse registre, registrerte gjenstander i en nettbutikk, osv. Når vi oppretter en konto på en nettside, vil den lagres i en database, sammen med et passord. Når vi logger inn på nettsiden, skriver vi altså inn brukernavnet og passordet. Da sender vi en forespørsel ("_query_") til nettsiden. Da spør vi om nettsiden kan se i databasen etter noen med det oppgritte brukernavnet og passordet. Dersom dette stemmer overens, vil du få logget inn på siden. 

Mange databaser er skrevet i et språk som heter SQL (Structured Query Language). Med SQL kan stille slike "_queries_" for å hente ut diverse ting fra databasen. La oss f.eks. si at vi har en database over alle studenter i Trondheim. Alle studentene er registrert med navn, unik student-id og studieretning. Vi kan da søke etter alle studenter som går KomTek, eller alle studenter som heter Ola. Man kan og spesifisere queriesene mer, og hente alle studenter som både heter Ola og går KomTek. Forskjellige versjoner av SQL har litt forskjellig syntax, men i all hovedsak ser det slik ut: 

SELECT ? FROM ? WHERE ? . 

Dersom man skal logge inn på en nettside med brukernavn=Ola og passord=fotball, kan det se slik ut:

SELECT \* FROM 'users' WHERE name='Ola' AND password='fotball'.

Her har vi hentet alt (\* betyr 'wildcard', altså at man henter alt), fra gruppen 'users' med brukernavn og passord som gitt. Merk at det er en enorm sårbarhet i en nettside om det ser slik ut. Det er mange steg som helst skal gjennomføres her, f.eks. _"hashing"_ av passord, med "_salt"_. 

Dersom man ikke har satt nødvendige restriksjoner på hvordan man logger inn eller søker på ting, kan man misbruke det. Uten de nødvendige restriksjonene, er nettsiden sårbar for blant annet _"SQL injection attack"_. Det betyr at vi bruker SQL-kommandoer rett inn i skrivefelt, som serveren forstår som kode. Disse nødvendige restriksjonene er gjerne at det ikke skal være lov å bruke spesielle tegn (som bindestrek, fnutter, osv.) i innlogging. 

### PicoCTF Web Exploitation oppg 6. 

